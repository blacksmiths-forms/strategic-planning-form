<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BlackSmiths LLC - ูููุฐุฌ ุงูุชุฎุทูุท ุงูุงุณุชุฑุงุชูุฌู</title>

  <style>
    body{font-family:Tajawal,Segoe UI,sans-serif;line-height:1.75;margin:40px;background:#f8f9fa}
    .header{background:linear-gradient(135deg,#FF6A00,#000000);color:#FFFFFF;padding:30px;text-align:center;border-radius:14px}
    .section{background:#FFFFFF;margin:20px 0;padding:25px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.08)}
    .partner-box{background:#FFF2E5;padding:15px;border-radius:10px;margin:15px 0;border-right:5px solid #FF6A00}
    .tip{background:#eef6ff;border:1px solid #cfe4ff;padding:12px;border-radius:10px;margin:12px 0}
    h2{color:#000;border-bottom:3px solid #FF6A00;padding-bottom:10px;margin:0 0 12px 0}
    h3{color:#000;margin:18px 0 6px 0}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:15px}
    label{display:block;font-weight:700;margin:8px 0 6px 0}
    textarea{
      width:100%;
      border:2px dashed #FF6A00;
      padding:12px;
      border-radius:10px;
      min-height:150px;
      background:#f8fafc;
      font-size:16px;
      resize:vertical;
      box-sizing:border-box;
    }
    textarea:focus{outline:none;border-color:#000000;background:#FFFFFF;box-shadow:0 0 0 3px rgba(255,106,0,0.18)}
    .example{color:#000;background:#FFF2E5;padding:12px;border-radius:8px;font-size:14px;margin:10px 0;border-left:4px solid #FF6A00}
    .example a{color:#000;text-decoration:underline}
    .toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center;margin:18px 0 0 0}
    .btn{background:#FF6A00;color:#FFFFFF;border:none;padding:12px 18px;font-size:16px;border-radius:10px;cursor:pointer}
    .btn.secondary{background:#000000}
    .btn.ghost{background:#FFFFFF;color:#000;border:1px solid #ddd}
    .btn:disabled{opacity:0.55;cursor:not-allowed}
    .status{margin:12px auto 0 auto;max-width:980px;text-align:center;font-size:14px;color:#333}
    .footer{text-align:center;padding:20px;background:#000000;border-radius:12px;margin:30px 0}
    .footer h3{color:#FFFFFF;margin:0}
    .no-print{display:block}
    @media print{
      body{margin:0;background:#fff}
      .no-print{display:none}
      .section{box-shadow:none}
      .header{border-radius:0}
      textarea{border:1px solid #ddd;background:#fff;box-shadow:none}
    }

    /* ===== Modal for sources (in-page) ===== */
    .modal-backdrop{
      position:fixed; inset:0;
      background:rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:9999;
    }
    .modal{
      background:#fff;
      width:min(1100px, 96vw);
      height:min(80vh, 780px);
      border-radius:14px;
      overflow:hidden;
      box-shadow:0 12px 50px rgba(0,0,0,0.35);
      display:flex;
      flex-direction:column;
    }
    .modal-header{
      background:#000;
      color:#fff;
      padding:12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .modal-header .title{
      font-weight:700;
      font-size:14px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .modal-header .actions{
      display:flex; gap:8px; align-items:center;
      flex-wrap:wrap;
    }
    .modal-header .smallbtn{
      background:#FF6A00;
      color:#fff;
      border:none;
      border-radius:10px;
      padding:8px 10px;
      cursor:pointer;
      font-size:13px;
      text-decoration:none;
      display:inline-block;
    }
    .modal-header .smallbtn.ghost{
      background:transparent;
      border:1px solid rgba(255,255,255,0.25);
    }
    .modal-body{
      flex:1;
      background:#f4f6f8;
      position:relative;
    }
    .modal-body iframe{
      width:100%;
      height:100%;
      border:0;
      background:#fff;
    }
    .modal-hint{
      position:absolute;
      inset:auto 12px 12px 12px;
      background:rgba(255,255,255,0.92);
      border:1px solid #e5e7eb;
      border-radius:12px;
      padding:10px 12px;
      font-size:13px;
      display:none;
    }

    @media (max-width: 1000px){ body{margin:22px} }
    @media (max-width: 700px){
      body{margin:14px}
      .section{padding:16px}
      .header{padding:20px}
      .grid{grid-template-columns:1fr}
      textarea{min-height:140px;font-size:16px}
      .toolbar{justify-content:stretch}
      .btn{width:100%}
      .modal{width:96vw;height:86vh}
    }
  </style>
</head>

<body>
  <div class="header">
    <h1 style="margin:0">๐ญ BlackSmiths LLC</h1>
    <h2 style="margin:10px 0 0 0;color:#FFFFFF;border-bottom:none">ูููุฐุฌ ุงูุชุฎุทูุท ุงูุงุณุชุฑุงุชูุฌู</h2>
  </div>

  <div class="partner-box no-print">
    <strong>ุชุนูููุงุช ุณุฑูุนุฉ:</strong>
    ุงูุชุจ ููุง ุชููุฑ โข ูุง ุชุญุงูู ุชูููุน ุงูุงุฌุงุจุฉ โข ูููุง ููุช ุตุฑูุญุง ูุงูุช ุงููุชุงุฆุฌ ุงูุถู
  </div>

  <div class="section no-print">
    <h2>ุงุฏูุงุช ุงููููุฐุฌ</h2>
    <div class="toolbar">
      <button class="btn" id="btnSave">ุญูุธ ุงูุขู</button>
      <button class="btn ghost" id="btnUndo">ุชุฑุงุฌุน ุนู ุขุฎุฑ ุชุนุฏูู</button>
      <button class="btn secondary" id="btnPrint">ุทุจุงุนุฉ / ุญูุธ PDF</button>
      <button class="btn ghost" id="btnClear">ูุณุญ ูู ุงูุจูุงูุงุช</button>
      <button class="btn secondary" id="btnSubmit">ุฅุฑุณุงู</button>
    </div>
    <div class="status" id="status">ุฌุงูุฒ.</div>
  </div>

  <div class="section">
    <h2>1. ูุถุน ุงูุดุฑูุฉ ุงููุชููุน ูู 31/12/2026</h2>

    <div class="tip">
      <strong>ููู ุชูุชุจุ</strong> ุงุณุชุฎุฏู ุฌูู ูุตูุฑุฉ ุงู ููุงุท. ุงุฐุง ูุง ุชุนุฑู ุฑููุง ุฏูููุงุ ุงูุชุจ ุชูุฏูุฑุง ุงู "ุชูุฑูุจุง".
    </div>

    <label for="s1_products">1) ุงูููุชุฌุงุช ูุงูุฎุฏูุงุช</label>
    <textarea id="s1_products" placeholder="ุงูุชุจ ููุง..."></textarea>
    <div class="example">
      <strong>ุฃูุซูุฉ:</strong><br>
      โข ุณุงุจู (SABIC): "Our vision is to be the preferred world leader in chemicals."<br>
      (ุฑุคูุชูุง ุฃู ูุตุจุญ ุงูุดุฑูุฉ ุงูุนุงูููุฉ ุงูุฑุงุฆุฏุฉ ุงูููุถูุฉ ูู ูุฌุงู ุงููููุงููุงุช.)<br>
      <a href="https://www.sabic.com/en/about/our-vision" class="source-link">ุงููุตุฏุฑ ุงูุฑุณูู</a>
    </div>

    <label for="s1_structure">2) ุงููููู ูุงููุฑูุน ูุนุฏุฏ ุงูููุธููู</label>
    <textarea id="s1_structure" placeholder="ุงูุชุจ ููุง..."></textarea>
    <div class="example">
      <strong>ุฃูุซูุฉ:</strong><br>
      โข ุณุงุจู (SABIC): "SABIC is a global diversified chemicals company, headquartered in Riyadh, Saudi Arabia."<br>
      <a href="https://www.sabic.com/en/about/corporate-profile/sabic-at-a-glance" class="source-link">ุงููุตุฏุฑ ุงูุฑุณูู</a>
    </div>

    <label for="s1_finance">3) ุงููุถุน ุงููุงูู (ุงูุงูุฑุงุฏุงุช/ุงููุตุฑููุงุช/ุงูุงุฑุจุงุญ)</label>
    <textarea id="s1_finance" placeholder="ุงูุชุจ ููุง..."></textarea>
    <div class="example">
      <strong>ุฃูุซูุฉ:</strong><br>
      โข ุณุงุจู (SABIC): "โฆoperational excellenceโฆ"<br>
      (โฆุงูุชููุฒ ุงูุชุดุบูููโฆ)<br>
      <a href="https://www.sabic.com/en/about/our-vision" class="source-link">ุงููุตุฏุฑ ุงูุฑุณูู</a>
    </div>

    <label for="s1_tech">4) ุงูุชูููุฉ ุงููุณุชุนููุฉ</label>
    <textarea id="s1_tech" placeholder="ุงูุชุจ ููุง..."></textarea>
    <div class="example">
      <strong>ุฃูุซูุฉ:</strong><br>
      โข stc group: "digital and telco leader, enabling the society and economy to thrive, in KSA and beyond."<br>
      <a href="https://www.stc.com/content/stcgroupwebsite/sa/en/who-we-are/our-strategy.html" class="source-link">ุงููุตุฏุฑ ุงูุฑุณูู</a>
    </div>
  </div>

  <div class="section">
    <h2>2. ุงูุฑุคูุฉ (Vision)</h2>
    <div class="tip"><strong>ูุณุงุนุฏุฉ:</strong> ุงูุฑุคูุฉ ุฌููุฉ ูุงุญุฏุฉ ุชูุถุญ: ุงูู ุงูู ูุตูุ</div>

    <label for="s2_vision">ุงูุชุจ ุงูุฑุคูุฉ</label>
    <textarea id="s2_vision" placeholder="ุงูุชุจ ููุง..."></textarea>

    <div class="example">
      <strong>ุฃูุซูุฉ:</strong><br>
      โข ุณุงุจู (SABIC): "Our vision is to be the preferred world leader in chemicals."<br>
      <a href="https://www.sabic.com/en/about/our-vision" class="source-link">ุงููุตุฏุฑ ุงูุฑุณูู</a><br><br>
      โข stc group: "digital and telco leader, enabling the society and economy to thrive, in KSA and beyond."<br>
      <a href="https://www.stc.com/content/stcgroupwebsite/sa/en/who-we-are/our-strategy.html" class="source-link">ุงููุตุฏุฑ ุงูุฑุณูู</a>
    </div>
  </div>

  <div class="section">
    <h2>3. ุงูุฑุณุงูุฉ (Mission)</h2>
    <div class="tip"><strong>ูุณุงุนุฏุฉ:</strong> ุงูุฑุณุงูุฉ 1โ2 ุฌููุฉ: ูููุ ูุงุฐุง ููุฏูุ ูููุ ููุง ุงููุชูุฌุฉุ</div>

    <label for="s3_mission">ุงูุชุจ ุงูุฑุณุงูุฉ</label>
    <textarea id="s3_mission" placeholder="ุงูุชุจ ููุง..."></textarea>

    <div class="example">
      <strong>ุฃูุซูุฉ:</strong><br>
      โข ุณุงุจู (SABIC): "โฆprovide quality products and servicesโฆ"<br>
      (โฆุชูุฏูู ููุชุฌุงุช ูุฎุฏูุงุช ุนุงููุฉ ุงูุฌูุฏุฉโฆ)<br>
      <a href="https://www.sabic.com/en/about/our-vision" class="source-link">ุงููุตุฏุฑ ุงูุฑุณูู</a>
    </div>
  </div>

  <div class="section">
    <h2>4. ุงูููู (Values)</h2>
    <div class="tip"><strong>ูุณุงุนุฏุฉ:</strong> ุงูุชุจ 4โ6 ูููุ ูููู ูููุฉ ูุซุงู ุณููู ูุซุจุชูุง.</div>

    <label for="s4_values">ุงูููู + ุงูุซูุฉ ุณููููุฉ</label>
    <textarea id="s4_values" placeholder="ุงูุชุจ ููุง..."></textarea>

    <div class="example">
      <strong>ุฃูุซูุฉ:</strong><br>
      โข ุณุงุจู (SABIC): "โฆINSPIRE, ENGAGE, CREATE and DELIVER."<br>
      (โฆูููููุ ูุดุงุฑูุ ูุจุฏุนุ ููููุฌุฒโฆ)<br>
      <a href="https://www.sabic.com/en/about/our-vision" class="source-link">ุงููุตุฏุฑ ุงูุฑุณูู</a><br><br>
      โข GSK: "Patient focusโฆ Integrityโฆ Respectโฆ Transparency."<br>
      (ุงูุชุฑููุฒ ุนูู ุงููุฑูุถโฆ ุงููุฒุงูุฉโฆ ุงูุงุญุชุฑุงูโฆ ุงูุดูุงููุฉ.)<br>
      <a href="https://www.gsk.com/media/qnmhqzmy/the-code-printable-version.pdf" class="source-link">ุงููุตุฏุฑ ุงูุฑุณูู</a>
    </div>
  </div>

  <div class="section">
    <h2>5. ูู ูุญู (Who We Are)</h2>
    <div class="tip"><strong>ูุณุงุนุฏุฉ:</strong> 3โ6 ุฌูู: ูู ูุญูุ ูุง ุงูุฐู ูุชููุฒ ุจูุ ููู ูุฎุฏูุ</div>

    <label for="s5_who">ุงูุชุจ ุชุนุฑูู ุงูุดุฑูุฉ</label>
    <textarea id="s5_who" placeholder="ุงูุชุจ ููุง..."></textarea>

    <div class="example">
      <strong>ุฃูุซูุฉ:</strong><br>
      โข ุณุงุจู (SABIC): "SABIC is a global diversified chemicals company, headquartered in Riyadh, Saudi Arabia."<br>
      <a href="https://www.sabic.com/en/about/corporate-profile/sabic-at-a-glance" class="source-link">ุงููุตุฏุฑ ุงูุฑุณูู</a>
    </div>
  </div>

  <div class="section">
    <h2>6. ุงูุงูุฏุงู ุงููุจุฑู 2030 + ุงูุฏุงู ุงูุณูุฉ ุงูุงููู 2027</h2>

    <div class="tip">
      <strong>ูุณุงุนุฏุฉ:</strong> ุงูุชุจ ุงูุฏุงู 2030 ุนูู ููุธูุฑ Balanced Scorecard (4 ูุญุงูุฑ)ุ ุซู ุงูุฏุงู 2027 ุจููุณ ุงููุญุงูุฑ.
    </div>

    <div class="example">
      <strong>ุฃุณุฆูุฉ ูุญูุฒุฉ (ูุชุณููู ุงููุชุงุจุฉ):</strong><br>
      โข ูุง ุงูุดูุก ุงูุฐู ูู ุชุญูู ุณูุบูุฑ ุงููุนุจุฉุ<br>
      โข ูุง ุงูุฐู ุณููููู ุงู ูููููุ ููุง ุงูุฐู ุณูุถุงุนููุ<br>
      โข ูุง ุงููุคุดุฑ ุงูุจุณูุท ุงูุฐู ูุซุจุช ุงูุชูุฏูุ (ุฑูู/ูุณุจุฉ/ูุฏุฉ/ุนุฏุฏ)<br>
      โข ูุง "ุนูู ุงูุฒุฌุงุฌุฉ" ุงูุญุงูู ุงูุฐู ูุฌุจ ูุณุฑู ุงููุงุ
    </div>

    <div class="example">
      <strong>ูุซุงู ููุชูุถูุญ (ููุณ ูุนูุงุฑุง โ ููุท ูุชุญููุฒ ุงูุชูููุฑ):</strong><br><br>

      <strong>ุฃ) 2030 โ ููู ุชุจุฏู ุงูุดุฑูุฉ ุงุฐุง ูุฌุญุชุ</strong><br>
      โข <strong>ูุงููุฉ:</strong> "ูุตู ูุชุฏูู ููุฏู ุซุงุจุช ูุบุทู ุงูุชูุณุน ุจุฏูู ุถุบุท"ุ "ูุฑูุน ูุงูุด ุงูุฑุจุญ ุนุจุฑ ุชูููู ุงููุฏุฑ"ุ "ุชูููุน ูุตุงุฏุฑ ุงูุฏุฎู ุจุฏู ุงูุงุนุชูุงุฏ ุนูู ุนููู/ููุชุฌ ูุงุญุฏ".<br>
      โข <strong>ุงูุนููุงุก:</strong> "ูุตุจุญ ุงูุฎูุงุฑ ุงูุฃูู ูู ูุทุงุน ูุญุฏุฏ"ุ "ูุจูู ุชุฌุฑุจุฉ ุนููู ุชุฌุนู ุงูุชูุฑุงุฑ ุชููุงุฆู"ุ "ุณูุนุฉ ูููุฉ (NPS/ุฑุถุง)".<br>
      โข <strong>ุงูุนูููุงุช ุงูุฏุงุฎููุฉ:</strong> "ุนูููุฉ ุชุณููู/ุชุดุบูู ุจุฏูู ููุถู"ุ "ูุนุงููุฑ ุฌูุฏุฉ ูุงุถุญุฉ"ุ "ููุช ุฏูุฑุฉ (Cycle time) ุฃูู"ุ "ุชูุงุฑูุฑ ุชุดุบูู ุฃุณุจูุนูุฉ".<br>
      โข <strong>ุงูููุธููู ูุงูุชุนูู:</strong> "ูุงุฏุฉ ุตู ุซุงูู"ุ "ุฎุทุฉ ุชุฏุฑูุจ ูุงุถุญุฉ"ุ "ุซูุงูุฉ ูุณุงุกูุฉ ุจุฏูู ุฎูู"ุ "ุชูุธูู ููุนู ูุบุทู ุงููุฌูุงุช".<br><br>

      <strong>ุจ) 2027 โ ูุง ุงูุฎุทูุฉ ุงูุฃููู ุงููุงูุนูุฉ ูุญู 2030ุ</strong><br>
      โข <strong>ูุงููุฉ:</strong> "ูุบูู 3 ุนููุฏ ุฑุฆูุณูุฉ"ุ "ูุญุณู ุงูุชุญุตูู ุฎูุงู 30 ููู"ุ "ูููู/ูููู ุฎุฏูุฉ ุบูุฑ ูุฑุจุญุฉ".<br>
      โข <strong>ุงูุนููุงุก:</strong> "ูุญุฏุฏ ุดุฑูุญุฉ ุงูุนููุงุก ุงููุซุงููุฉ"ุ "ูุซุจุช ุนุฑุถ ูููุฉ ูุงุญุฏ ูุงุถุญ"ุ "ูุญุณู ุฑุญูุฉ ูุง ุจุนุฏ ุงูุจูุน".<br>
      โข <strong>ุงูุนูููุงุช ุงูุฏุงุฎููุฉ:</strong> "ููุซู ุงูุนูููุงุช ุงูุฃุณุงุณูุฉ"ุ "ูุทุจูู ูุธุงู ูุชุงุจุนุฉ ููุงู/ุฌูุฏุฉ"ุ "ูููู ุฃุฎุทุงุก ุงูุชุณููู".<br>
      โข <strong>ุงูููุธููู ูุงูุชุนูู:</strong> "ุชูุธูู ุฏูุฑูู ุญุงุณููู"ุ "ุจุฑูุงูุฌ ุชุฏุฑูุจ ูุตูุฑ ุดูุฑู"ุ "ุงุฌุชูุงุน ุฃุฏุงุก ุฃุณุจูุนู ุซุงุจุช".<br><br>

      <strong>ููุงุญุธุฉ:</strong> ุงูุชุจ ุฃูุฏุงูู ุจุตูุบุฉ "ูุฑูุฏ ุฃู..." ุซู ุฃุถู "ููู ุณูููุณูุงุ" ุญุชู ูู ูุงู ุงูููุงุณ ุชูุฑูุจููุง.
    </div>

    <h3>ุงูุฏุงู 2030 (Balanced Scorecard)</h3>
    <div class="grid">
      <div>
        <label for="s6_2030_fin">ูุงููุฉ (2030)</label>
        <textarea id="s6_2030_fin" placeholder="ุงูุชุจ ููุง..."></textarea>
      </div>
      <div>
        <label for="s6_2030_cust">ุงูุนููุงุก (2030)</label>
        <textarea id="s6_2030_cust" placeholder="ุงูุชุจ ููุง..."></textarea>
      </div>
      <div>
        <label for="s6_2030_internal">ุงูุนูููุงุช ุงูุฏุงุฎููุฉ (2030)</label>
        <textarea id="s6_2030_internal" placeholder="ุงูุชุจ ููุง..."></textarea>
      </div>
      <div>
        <label for="s6_2030_people">ุงูููุธููู ูุงูุชุนูู (2030)</label>
        <textarea id="s6_2030_people" placeholder="ุงูุชุจ ููุง..."></textarea>
      </div>
    </div>

    <h3 style="margin-top:20px">ุงูุฏุงู 2027</h3>
    <div class="grid">
      <div>
        <label for="s6_2027_fin">ูุงููุฉ (2027)</label>
        <textarea id="s6_2027_fin" placeholder="ุงูุชุจ ููุง..."></textarea>
      </div>
      <div>
        <label for="s6_2027_cust">ุงูุนููุงุก (2027)</label>
        <textarea id="s6_2027_cust" placeholder="ุงูุชุจ ููุง..."></textarea>
      </div>
      <div>
        <label for="s6_2027_internal">ุงูุนูููุงุช ุงูุฏุงุฎููุฉ (2027)</label>
        <textarea id="s6_2027_internal" placeholder="ุงูุชุจ ููุง..."></textarea>
      </div>
      <div>
        <label for="s6_2027_people">ุงูููุธููู ูุงูุชุนูู (2027)</label>
        <textarea id="s6_2027_people" placeholder="ุงูุชุจ ููุง..."></textarea>
      </div>
    </div>
  </div>

  <div class="section">
    <h2>7. ููุงุญุธุงุช</h2>
    <label for="s7_notes">ุงู ููุงุญุธุงุช ูููุฉ ูุจู ุงูุงุฌุชูุงุน</label>
    <textarea id="s7_notes" placeholder="ุงูุชุจ ููุง..."></textarea>
  </div>

  <div class="footer">
    <h3>ุณูุชู ุฌูุน ุฌููุน ุงููุณุฎ ูู ุงุฌุชูุงุน ูุดุชุฑู ูุตูุงุบุฉ ุงููุณุฎุฉ ุงูููุงุฆูุฉ</h3>
  </div>

  <div style="text-align:center;margin:30px 0" class="no-print">
    <button class="btn secondary" id="btnSubmitBottom">ุฅุฑุณุงู</button>
  </div>

  <!-- Redirect submit form (NO target, NO iframe, NO popup) -->
  <form id="submitForm" class="no-print"
        action="https://script.google.com/macros/s/AKfycbwVr3kCNhoWAcslUQlM5aEYVwU5NM8o1kNegA9y2lb2wf-Sl8Gj2ZOj6qvBpAAy0VI/exec"
        method="POST" style="display:none">
    <input type="hidden" name="payload" id="payloadField" value="">
  </form>

  <!-- ===== Modal (in-page sources) ===== -->
  <div class="modal-backdrop no-print" id="sourceModalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="ุงููุตุฏุฑ ุงูุฑุณูู">
      <div class="modal-header">
        <div class="title" id="sourceModalTitle">ุงููุตุฏุฑ ุงูุฑุณูู</div>
        <div class="actions">
          <a class="smallbtn ghost" id="sourceModalOpenNew" href="#" target="_blank" rel="noopener">ูุชุญ ูู ุชุจููุจ ุฌุฏูุฏ</a>
          <button class="smallbtn" id="sourceModalClose" type="button">ุฅุบูุงู</button>
        </div>
      </div>
      <div class="modal-body">
        <iframe id="sourceModalFrame" title="ุงููุตุฏุฑ ุงูุฑุณูู"></iframe>
        <div class="modal-hint" id="sourceModalHint">
          ูุฏ ูููุน ุงููููุน ุงูุนุฑุถ ุฏุงุฎู ูุฐู ุงููุงูุฐุฉ. ุงุณุชุฎุฏู ุฒุฑ "ูุชุญ ูู ุชุจููุจ ุฌุฏูุฏ".
        </div>
      </div>
    </div>
  </div>

  <script>
    const SHEET_ID_USED = "1kTuTJboa_M9pAcAudFY2UGtYWYurRV2w3pps5VjoQqE";
    const STORAGE_KEY = "blacksmiths_strategic_form_v13_redirect_submit";

    const FIELD_IDS = [
      "s1_products","s1_structure","s1_finance","s1_tech",
      "s2_vision","s3_mission","s4_values","s5_who",
      "s6_2030_fin","s6_2030_cust","s6_2030_internal","s6_2030_people",
      "s6_2027_fin","s6_2027_cust","s6_2027_internal","s6_2027_people",
      "s7_notes"
    ];

    const statusEl = document.getElementById("status");
    function nowTime(){ return new Date().toLocaleString("ar-SA"); }
    function setStatus(msg){ if(statusEl) statusEl.textContent = msg; }

    function getAllData(){
      const data = { _meta: { savedAt: nowTime(), version: 13, sheetId: SHEET_ID_USED } };
      for (const id of FIELD_IDS){
        const el = document.getElementById(id);
        data[id] = el ? el.value : "";
      }
      return data;
    }

    function setAllData(data){
      for (const id of FIELD_IDS){
        const el = document.getElementById(id);
        if (el) el.value = (data && typeof data[id] === "string") ? data[id] : "";
      }
    }

    function saveToLocal(){
      const data = getAllData();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      setStatus("ุชู ุงูุญูุธ ูุญููุง: " + data._meta.savedAt);
    }

    function loadFromLocal(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw){ setStatus("ูุง ููุฌุฏ ุจูุงูุงุช ูุญููุธุฉ ูุญููุง ุจุนุฏ."); return; }
      try{
        const data = JSON.parse(raw);
        setAllData(data);
        setStatus("ุชู ุชุญููู ุจูุงูุงุช ูุญููุธุฉ: " + (data?._meta?.savedAt || nowTime()));
      }catch(e){
        setStatus("ุชุนุฐุฑ ูุฑุงุกุฉ ุงูุจูุงูุงุช ุงููุญููุธุฉ (ูุฏ ุชููู ุชุงููุฉ).");
      }
    }

    function clearAll(){
      for (const id of FIELD_IDS){
        const el = document.getElementById(id);
        if (el) el.value = "";
      }
      localStorage.removeItem(STORAGE_KEY);
      setStatus("ุชู ูุณุญ ุงูุจูุงูุงุช.");
    }

    let saveTimer = null;
    function scheduleAutosave(){
      if (saveTimer) clearTimeout(saveTimer);
      saveTimer = setTimeout(() => saveToLocal(), 600);
    }

    let lastUndo = null;
    function captureUndoState(el){
      if (!el || !el.id) return;
      lastUndo = {
        id: el.id,
        value: el.value,
        selStart: (typeof el.selectionStart === "number") ? el.selectionStart : null,
        selEnd: (typeof el.selectionEnd === "number") ? el.selectionEnd : null
      };
      const btnUndo = document.getElementById("btnUndo");
      if (btnUndo) btnUndo.disabled = false;
    }

    function doUndo(){
      if (!lastUndo) { setStatus("ูุง ููุฌุฏ ุชุนุฏูู ููุชุฑุงุฌุน ุนูู."); return; }
      const el = document.getElementById(lastUndo.id);
      if (!el) { setStatus("ุชุนุฐุฑ ุงูุชุฑุงุฌุน (ุงูุญูู ุบูุฑ ููุฌูุฏ)."); return; }
      el.value = lastUndo.value;
      el.focus();
      try{
        if (lastUndo.selStart !== null && lastUndo.selEnd !== null){
          el.setSelectionRange(lastUndo.selStart, lastUndo.selEnd);
        }
      }catch(_){}
      lastUndo = null;
      const btnUndo = document.getElementById("btnUndo");
      if (btnUndo) btnUndo.disabled = true;
      scheduleAutosave();
      setStatus("ุชู ุงูุชุฑุงุฌุน ุนู ุขุฎุฑ ุชุนุฏูู.");
    }

    let isSubmitting = false;
    function setSubmittingUI(on){
      const btnSubmit = document.getElementById("btnSubmit");
      const btnSubmitBottom = document.getElementById("btnSubmitBottom");
      if (btnSubmit) btnSubmit.disabled = on;
      if (btnSubmitBottom) btnSubmitBottom.disabled = on;
      if (btnSubmit) btnSubmit.textContent = on ? "ุฌุงุฑู ุงูุฅุฑุณุงู..." : "ุฅุฑุณุงู";
      if (btnSubmitBottom) btnSubmitBottom.textContent = on ? "ุฌุงุฑู ุงูุฅุฑุณุงู..." : "ุฅุฑุณุงู";
    }

    function submitToServer(){
      if (isSubmitting) return;
      isSubmitting = true;
      setSubmittingUI(true);
      setStatus("ุฌุงุฑู ุงูุฅุฑุณุงู...");

      const data = getAllData();
      document.getElementById("payloadField").value = JSON.stringify(data);

      // Redirect submit: ุณูุชู ุงูุงูุชูุงู ูุตูุญุฉ "ุชู ุงูุฅุฑุณุงู" ุซู ุงูุฑุฌูุน ุชููุงุฆูุง
      document.getElementById("submitForm").submit();
    }

    // Modal sources
    const backdrop = document.getElementById("sourceModalBackdrop");
    const frame2 = document.getElementById("sourceModalFrame");
    const titleEl = document.getElementById("sourceModalTitle");
    const hintEl = document.getElementById("sourceModalHint");
    const openNewEl = document.getElementById("sourceModalOpenNew");
    const closeBtn = document.getElementById("sourceModalClose");

    function openSourceModal(url){
      hintEl.style.display = "none";
      frame2.src = "about:blank";
      titleEl.textContent = "ุงููุตุฏุฑ ุงูุฑุณูู";
      openNewEl.href = url;
      backdrop.style.display = "flex";
      backdrop.setAttribute("aria-hidden", "false");
      frame2.src = url;
      setTimeout(() => { hintEl.style.display = "block"; }, 2500);
    }

    function closeSourceModal(){
      frame2.src = "about:blank";
      backdrop.style.display = "none";
      backdrop.setAttribute("aria-hidden", "true");
    }

    backdrop.addEventListener("click", (e) => { if (e.target === backdrop) closeSourceModal(); });
    closeBtn.addEventListener("click", closeSourceModal);
    document.addEventListener("keydown", (e) => { if (e.key === "Escape" && backdrop.style.display === "flex") closeSourceModal(); });

    window.addEventListener("DOMContentLoaded", () => {
      loadFromLocal();

      const btnUndo = document.getElementById("btnUndo");
      if (btnUndo) btnUndo.disabled = true;

      for (const id of FIELD_IDS){
        const el = document.getElementById(id);
        if (!el) continue;
        el.addEventListener("beforeinput", () => captureUndoState(el));
        el.addEventListener("focus", () => captureUndoState(el));
        el.addEventListener("input", scheduleAutosave);
      }

      const btnSave = document.getElementById("btnSave");
      if (btnSave) btnSave.addEventListener("click", saveToLocal);

      if (btnUndo) btnUndo.addEventListener("click", doUndo);

      const btnSubmit = document.getElementById("btnSubmit");
      if (btnSubmit) btnSubmit.addEventListener("click", submitToServer);

      const btnSubmitBottom = document.getElementById("btnSubmitBottom");
      if (btnSubmitBottom) btnSubmitBottom.addEventListener("click", submitToServer);

      const btnPrint = document.getElementById("btnPrint");
      if (btnPrint) btnPrint.addEventListener("click", () => window.print());

      const btnClear = document.getElementById("btnClear");
      if (btnClear) btnClear.addEventListener("click", () => {
        const ok = confirm("ูู ุงูุช ูุชุฃูุฏุ ุณูุชู ูุณุญ ูู ุงูุจูุงูุงุช ูู ูุฐุง ุงูุฌูุงุฒ.");
        if (ok) clearAll();
      });

      document.querySelectorAll("a.source-link").forEach(a => {
        a.setAttribute("rel", "noopener");
        a.addEventListener("click", (e) => {
          e.preventDefault();
          const url = a.getAttribute("href");
          if (url) openSourceModal(url);
        });
      });
    });
  </script>
</body>
</html>
